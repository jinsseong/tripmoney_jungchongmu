# 정산 알고리즘 설명서

## 🎯 핵심 원리

이 앱의 정산 알고리즘은 **최소 송금 횟수**로 **정확한 정산**을 보장합니다.

### 1. 지출 분담 계산

- 각 지출마다 **참여자를 개별 선택** 가능
- 참여한 사람들만 해당 지출을 **n분의 1**로 분담
- **참여하지 않은 사람은 자동으로 제외**됨

### 2. 차액 정산

```
net_balance = (실제 결제 금액) - (부담해야 할 금액)
```

- **양수(+)**: 다른 사람들이 이 사람에게 줘야 할 금액 (받을 돈)
- **음수(-)**: 이 사람이 다른 사람들에게 줘야 할 금액 (낼 돈)
- **0**: 정산 완료

### 3. 최적화된 송금

- **Greedy 알고리즘** 사용
- 가장 많이 받을 사람과 가장 많이 낼 사람을 매칭
- 최소 송금 횟수로 정산 완료

---

## 📝 테스트 시나리오

### 시나리오 1: 기본 3인 여행

**참여자:** A, B, C

**지출 내역:**
1. A가 30,000원 지출 (참여자: A, B, C)
2. C가 15,000원 지출 (참여자: A, B, C)

**정산 계산:**

| 참여자 | 지출 1 분담 | 지출 2 분담 | 총 부담 | 실제 결제 | 차액 (받을/낼 돈) |
|--------|-------------|-------------|---------|-----------|-------------------|
| A      | 10,000원    | 5,000원     | 15,000원 | 30,000원  | **+15,000원** (받을 돈) |
| B      | 10,000원    | 5,000원     | 15,000원 | 0원       | **-15,000원** (낼 돈) |
| C      | 10,000원    | 5,000원     | 15,000원 | 15,000원  | **0원** (정산 완료) |

**최적화 송금:**
- B가 A에게 15,000원 송금 → **1번의 송금으로 정산 완료!**

**검증:** 15,000 + (-15,000) + 0 = 0 ✓

---

### 시나리오 2: 선택적 참여 (핵심!)

**참여자:** A, B, C

**지출 내역:**
1. A가 30,000원 지출 (참여자: A, B, C 모두) → 각자 10,000원 부담
2. B가 20,000원 지출 (참여자: **B, C만**) → **B와 C만** 각자 10,000원 부담 (A 제외)
3. C가 15,000원 지출 (참여자: A, B, C 모두) → 각자 5,000원 부담

**정산 계산:**

| 참여자 | 지출 1 분담 | 지출 2 분담 | 지출 3 분담 | 총 부담 | 실제 결제 | 차액 |
|--------|-------------|-------------|-------------|---------|-----------|------|
| A      | 10,000원    | **0원**     | 5,000원     | 15,000원 | 30,000원  | **+15,000원** |
| B      | 10,000원    | 10,000원    | 5,000원     | 25,000원 | 20,000원  | **-5,000원** |
| C      | 10,000원    | 10,000원    | 5,000원     | 25,000원 | 15,000원  | **-10,000원** |

**최적화 송금:**
1. C가 A에게 10,000원 송금 → C 정산 완료
2. B가 A에게 5,000원 송금 → 모두 정산 완료

**총 2번의 송금으로 정산 완료!**

**검증:** 15,000 + (-5,000) + (-10,000) = 0 ✓

**핵심 포인트:**
- A는 지출 2에 참여하지 않아서 부담금이 0원
- B와 C만 지출 2를 부담
- 참여자를 개별 선택할 수 있어 **공평한 정산** 가능

---

### 시나리오 3: 복잡한 4인 여행

**참여자:** A, B, C, D

**지출 내역:**
1. A가 40,000원 지출 (참여자: A, B, C, D) → 각자 10,000원
2. B가 30,000원 지출 (참여자: B, C, D만) → 각자 10,000원
3. C가 20,000원 지출 (참여자: A, C만) → 각자 10,000원
4. D가 10,000원 지출 (참여자: 모두) → 각자 2,500원

**정산 계산:**

| 참여자 | 총 부담 | 실제 결제 | 차액 |
|--------|---------|-----------|------|
| A      | 22,500원 | 40,000원  | **+17,500원** |
| B      | 22,500원 | 30,000원  | **+7,500원** |
| C      | 32,500원 | 20,000원  | **-12,500원** |
| D      | 22,500원 | 10,000원  | **-12,500원** |

**최적화 송금:**
1. C가 A에게 12,500원 송금
2. D가 A에게 5,000원 송금
3. D가 B에게 7,500원 송금

**총 3번의 송금으로 정산 완료!**

**검증:** 17,500 + 7,500 + (-12,500) + (-12,500) = 0 ✓

---

## 🔍 알고리즘 검증

### 자동 검증 기능

앱에는 **자동 검증 시스템**이 내장되어 있습니다:

1. **정산 합계 검증**: 모든 차액의 합이 0인지 확인
2. **송금 검증**: 송금 후 모든 잔액이 0이 되는지 확인

정산이 잘못되었을 경우 대시보드에 **빨간색 경고**가 표시됩니다.

### 수동 검증 방법

1. 각 참여자의 **부담 금액 합계** 확인
2. 각 참여자의 **실제 결제 금액** 확인
3. **차액 계산**: 실제 결제 - 부담 금액
4. **합계 검증**: 모든 차액의 합 = 0 이어야 함

---

## 💡 주요 장점

### 1. 선택적 참여
- 모든 지출마다 참여자를 개별 선택
- 참여하지 않은 사람은 부담 없음
- 공평한 정산

### 2. 최소 송금
- Greedy 알고리즘으로 최적화
- 최소 횟수로 정산 완료
- 복잡한 정산을 간단하게

### 3. 정확성 보장
- 자동 검증 시스템
- 합계가 항상 0이 되도록 보장
- 오류 발생 시 즉시 알림

### 4. 투명성
- 모든 계산 과정이 투명하게 표시
- 각자의 부담 금액과 차액을 명확히 확인
- 송금 안내로 정산 방법 제시

---

## 🧪 직접 테스트하기

### 테스트 순서

1. **참가자 추가**: 여행에 참여할 사람들 등록
2. **지출 추가**: 각 지출마다 참여자 선택
3. **정산 확인**: 대시보드에서 정산 현황 확인
4. **검증**: 초록색 체크 마크 확인
5. **송금**: 송금 안내에 따라 정산 완료

### 테스트 시나리오 실행

위의 **시나리오 2**를 실제로 입력해보세요:

1. 참가자 A, B, C 추가
2. 지출 추가:
   - A가 30,000원 (참여자: A, B, C)
   - B가 20,000원 (참여자: B, C만)
   - C가 15,000원 (참여자: A, B, C)
3. 대시보드에서 확인:
   - A: +15,000원 (받을 돈)
   - B: -5,000원 (낼 돈)
   - C: -10,000원 (낼 돈)
4. 송금 안내:
   - C → A: 10,000원
   - B → A: 5,000원

---

## 📞 문제 발생 시

만약 정산이 맞지 않는다면:

1. **빨간색 경고 확인**: 어떤 오류인지 메시지 확인
2. **지출 내역 재확인**: 모든 지출의 참여자가 올바른지 확인
3. **금액 확인**: 입력한 금액이 정확한지 확인
4. **새로고침**: 브라우저 새로고침 후 다시 확인

알고리즘은 수학적으로 검증되었으며, 정산 합계가 0이 되도록 보장합니다!

